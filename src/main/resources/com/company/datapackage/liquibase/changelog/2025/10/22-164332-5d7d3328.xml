<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1" author="datapackage">
        <dropForeignKeyConstraint baseTableName="DATA_PACKAGE_ORGANIZATION_LINK"
                                  constraintName="FK_DATPACORG_ON_DATA_PACKAGE"/>
    </changeSet>
    <changeSet id="2" author="datapackage">
        <dropForeignKeyConstraint baseTableName="DATA_PACKAGE_ORGANIZATION_LINK"
                                  constraintName="FK_DATPACORG_ON_ORGANIZATION"/>
    </changeSet>
    <changeSet id="3" author="datapackage">
        <dropForeignKeyConstraint baseTableName="DATA_PACKAGE_ROLE_LINK" constraintName="FK_DATPACROL_ON_DATA_PACKAGE"/>
    </changeSet>
    <changeSet id="4" author="datapackage">
        <dropForeignKeyConstraint baseTableName="DATA_PACKAGE_ROLE_LINK" constraintName="FK_DATPACROL_ON_ROLE"/>
    </changeSet>
    <changeSet id="5" author="datapackage">
        <dropForeignKeyConstraint baseTableName="DATA_PACKAGE_USER_LINK" constraintName="FK_DATPACUSE_ON_DATA_PACKAGE"/>
    </changeSet>
    <changeSet id="6" author="datapackage">
        <dropForeignKeyConstraint baseTableName="DATA_PACKAGE_USER_LINK" constraintName="FK_DATPACUSE_ON_USER"/>
    </changeSet>
    <changeSet id="7" author="datapackage">
        <createTable tableName="DATA_PACK_ORG">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_DATA_PACK_ORG"/>
            </column>
            <column name="DATA_PACKAGE_ID" type="UUID"/>
            <column name="ORGANIZATION_ID" type="UUID"/>
        </createTable>
    </changeSet>
    <changeSet id="8" author="datapackage">
        <createTable tableName="DATA_PACK_ROLE">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_DATA_PACK_ROLE"/>
            </column>
            <column name="DATA_PACKAGE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="ROLE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="9" author="datapackage">
        <createTable tableName="DATA_PACK_USER">
            <column name="ID" type="UUID">
                <constraints nullable="false" primaryKey="true" primaryKeyName="PK_DATA_PACK_USER"/>
            </column>
            <column name="DATA_PACKAGE_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="USER_ID" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="10" author="datapackage">
        <createIndex indexName="IDX_DATA_PACK_ORG_DATA_PACKAGE" tableName="DATA_PACK_ORG">
            <column name="DATA_PACKAGE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="DATA_PACKAGE_ID" baseTableName="DATA_PACK_ORG"
                                 constraintName="FK_DATA_PACK_ORG_ON_DATA_PACKAGE" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="DATA_PACKAGE"/>
    </changeSet>
    <changeSet id="11" author="datapackage">
        <createIndex indexName="IDX_DATA_PACK_ORG_ORGANIZATION" tableName="DATA_PACK_ORG">
            <column name="ORGANIZATION_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="ORGANIZATION_ID" baseTableName="DATA_PACK_ORG"
                                 constraintName="FK_DATA_PACK_ORG_ON_ORGANIZATION" referencedColumnNames="ID"
                                 referencedTableName="ORGANIZATION"/>
    </changeSet>
    <changeSet id="12" author="datapackage">
        <createIndex indexName="IDX_DATA_PACK_ROLE_DATA_PACKAGE" tableName="DATA_PACK_ROLE">
            <column name="DATA_PACKAGE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="DATA_PACKAGE_ID" baseTableName="DATA_PACK_ROLE"
                                 constraintName="FK_DATA_PACK_ROLE_ON_DATA_PACKAGE" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="DATA_PACKAGE"/>
    </changeSet>
    <changeSet id="13" author="datapackage">
        <createIndex indexName="IDX_DATA_PACK_ROLE_ROLE" tableName="DATA_PACK_ROLE">
            <column name="ROLE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="ROLE_ID" baseTableName="DATA_PACK_ROLE"
                                 constraintName="FK_DATA_PACK_ROLE_ON_ROLE" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="ROLE"/>
    </changeSet>
    <changeSet id="14" author="datapackage">
        <createIndex indexName="IDX_DATA_PACK_USER_DATA_PACKAGE" tableName="DATA_PACK_USER">
            <column name="DATA_PACKAGE_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="DATA_PACKAGE_ID" baseTableName="DATA_PACK_USER"
                                 constraintName="FK_DATA_PACK_USER_ON_DATA_PACKAGE" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="DATA_PACKAGE"/>
    </changeSet>
    <changeSet id="15" author="datapackage">
        <createIndex indexName="IDX_DATA_PACK_USER_USER" tableName="DATA_PACK_USER">
            <column name="USER_ID"/>
        </createIndex>

        <addForeignKeyConstraint baseColumnNames="USER_ID" baseTableName="DATA_PACK_USER"
                                 constraintName="FK_DATA_PACK_USER_ON_USER" onDelete="CASCADE"
                                 referencedColumnNames="ID" referencedTableName="USER_"/>
    </changeSet>
    <changeSet id="16" author="datapackage">
        <dropTable cascadeConstraints="true" tableName="DATA_PACKAGE_ORGANIZATION_LINK"/>
    </changeSet>
    <changeSet id="17" author="datapackage">
        <dropTable cascadeConstraints="true" tableName="DATA_PACKAGE_ROLE_LINK"/>
    </changeSet>
    <changeSet id="18" author="datapackage">
        <dropTable cascadeConstraints="true" tableName="DATA_PACKAGE_USER_LINK"/>
    </changeSet>
    <changeSet id="19" author="datapackage">
        <dropColumn columnName="DATA_PACKAGE_ID" tableName="ORGANIZATION"/>
    </changeSet>
</databaseChangeLog>